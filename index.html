<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The News Bruh - Neon Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000;
            --neon: #39FF14;
            --neon-dim: #1a5e0b;
            --old-english: 'UnifrakturMaguntia', serif;
            --mono: 'Courier Prime', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }

        body { 
            background: var(--bg); color: var(--neon); font-family: var(--mono); 
            display: flex; flex-direction: column; 
            height: 100dvh; 
            overflow: hidden;
            text-shadow: 0 0 5px var(--neon-dim);
            border: 2px solid var(--neon);
            box-shadow: inset 0 0 10px var(--neon-dim);
            border-radius: 4px;
            padding-bottom: env(safe-area-inset-bottom);
        }

        #save-status {
            position: absolute; top: 10px; right: 10px; font-size: 0.6rem;
            color: var(--neon); opacity: 0; transition: opacity 0.5s; z-index: 1000;
        }

        #header { border-bottom: 2px solid var(--neon); padding: 10px; text-align: center; background: rgba(0,0,0,0.9); z-index: 10; position: relative; }
        .header-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .global-msg-count { font-size: 0.55rem; color: var(--neon); border: 1px solid var(--neon-dim); padding: 2px 5px; background: rgba(57, 255, 20, 0.05); }
        .chat-indicator { display: flex; align-items: center; gap: 5px; font-size: 0.6rem; color: var(--neon); cursor: pointer; padding: 5px; }
        .chat-badge { background: var(--neon); color: #000; border-radius: 10px; padding: 2px 6px; font-weight: bold; font-size: 0.5rem; min-width: 16px; text-align: center; box-shadow: 0 0 5px var(--neon); }
        .chat-badge.hidden { display: none; }
        
        h1 { font-family: var(--old-english); font-size: clamp(1.8rem, 6vw, 3rem); color: var(--neon); text-shadow: 0 0 15px var(--neon); margin: 2px 0; }
        .network-stats { font-size: 0.6rem; color: var(--neon); margin-top: 2px; letter-spacing: 1px; text-transform: uppercase; }

        .stats-dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 8px; border-bottom: 1px solid var(--neon); background: #050505; font-size: 0.75rem; text-align: left; z-index: 9; }
        .stat-item { display: flex; justify-content: space-between; padding: 0 10px; }

        #clicker-area { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 5; }
        #emoji-stack { position: relative; width: 150px; height: 150px; }
        .paper-emoji { position: absolute; font-size: 70px; display: none; filter: drop-shadow(0 0 8px var(--neon)); transition: all 0.3s ease; }
        #p1, #p2, #p3, #p4, #p5, #p6, #p7, #p8, #p9 { position: absolute; font-size: 70px; display: none; }
        #p1 { top: 0; left: 0; transform: rotate(-5deg); }
        #p2 { top: 5px; left: 25px; transform: rotate(10deg); }
        #p3 { top: 10px; left: 50px; transform: rotate(-8deg); }
        #p4 { top: 30px; left: -5px; transform: rotate(15deg); }
        #p5 { top: 35px; left: 20px; transform: rotate(2deg); }
        #p6 { top: 40px; left: 55px; transform: rotate(-12deg); }
        #p7 { top: 55px; left: 5px; transform: rotate(7deg); }
        #p8 { top: 60px; left: 30px; transform: rotate(-3deg); }
        #p9 { top: 70px; left: 50px; transform: rotate(20deg); }

        .boost-control { margin-top: 40px; z-index: 100; text-align: center; }
        .btn-boost { background: var(--neon); color: #000; border: none; padding: 12px 24px; font-family: var(--mono); font-weight: bold; cursor: pointer; box-shadow: 0 0 15px var(--neon); }
        .btn-boost:disabled { background: #000; color: var(--neon-dim); box-shadow: none; cursor: not-allowed; border: 1px solid var(--neon-dim); }
        #boost-timer-display { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        .floating-text { position: absolute; color: var(--neon); font-weight: bold; pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 101; white-space: nowrap; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }

        #tab-container { flex-grow: 1; padding: 20px; overflow-y: auto; display: none; border: 2px solid var(--neon); margin: 15px; background: rgba(0,0,0,0.95); z-index: 20; }
        #tab-title { text-transform: capitalize; font-family: var(--old-english); border-bottom: 1px solid var(--neon); margin-bottom: 15px; font-size: 1.5rem; }
        .active-tab { display: block !important; }

        #chat-container { display: flex; flex-direction: column; height: 280px; border-top: 2px solid var(--neon); background: #000; z-index: 50; }
        .chat-toggle { display: flex; justify-content: space-between; align-items: center; padding: 8px 15px; background: rgba(57, 255, 20, 0.1); cursor: pointer; border-bottom: 1px solid var(--neon-dim); font-size: 0.7rem; font-weight: bold; }
        #chat-log { flex-grow: 1; overflow-y: auto; padding: 10px 15px; display: flex; flex-direction: column; gap: 8px; font-size: 0.75rem; }
        .chat-message { padding: 6px 10px; border-radius: 4px; background: rgba(57, 255, 20, 0.05); border-left: 2px solid var(--neon); animation: fadeIn 0.3s ease; position: relative; }
        .chat-time { position: absolute; right: 10px; top: 6px; font-size: 0.55rem; opacity: 0.6; }
        .chat-input-area { background: rgba(0,0,0,0.9); padding: 10px; border-top: 1px solid var(--neon-dim); }
        .chat-input-container { display: flex; }
        #chat-input { flex-grow: 1; background: #000; border: 1px solid var(--neon); color: var(--neon); padding: 12px; font-family: var(--mono); font-size: 0.85rem; outline: none; }
        #chat-send { background: var(--neon); color: #000; border: none; padding: 0 20px; font-family: var(--mono); font-weight: bold; cursor: pointer; margin-left: 5px; }

        .upgrade-row { border: 1px solid var(--neon); margin-bottom: 10px; padding: 10px; background: rgba(57, 255, 20, 0.02); }
        .upgrade-info { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 10px; }
        .upgrade-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-upgrade { background: var(--neon); color: #000; border: none; padding: 8px; font-family: var(--mono); font-weight: bold; cursor: pointer; font-size: 0.7rem; }
    </style>
</head>
<body>

<div id="save-status">CLOUD SAVED</div>

<div id="header">
    <div class="header-top-row">
        <div class="global-msg-count">MSG SENT: <span id="msg-total-val">0</span></div>
        <div class="chat-indicator" onclick="toggleChat()">
            ‚úâÔ∏è <span class="chat-badge hidden" id="unread-count">0</span>
        </div>
    </div>
    <div class="network-stats">Online: <span id="online-count">1</span> | <span id="live-time"></span></div>
    <h1>The News Bruh</h1>
</div>

<div class="stats-dashboard">
    <div class="stat-item"><span>üóûÔ∏è News:</span> <span id="res-new">0</span></div>
    <div class="stat-item"><span>Lvl:</span> <span id="stat-level">1</span></div>
    <div class="stat-item"><span>üëë Bruh:</span> <span id="res-bruh">0</span></div>
    <div class="stat-item"><span>Exp:</span> <span><span id="stat-exp">0</span></span></div>
    <div class="stat-item"><span>‚ö° Mult:</span> <span id="res-mult">1.0</span>x</div>
    <div class="stat-item"><span>Total Exp:</span> <span id="stat-total-exp">0</span></div>
</div>

<div id="clicker-area">
    <div id="emoji-stack">
        <div class="paper-emoji" id="p1" style="display:block">üóûÔ∏è</div>
        <div class="paper-emoji" id="p2">üóûÔ∏è</div>
        <div class="paper-emoji" id="p3">üóûÔ∏è</div>
        <div class="paper-emoji" id="p4">üóûÔ∏è</div>
        <div class="paper-emoji" id="p5">üóûÔ∏è</div>
        <div class="paper-emoji" id="p6">üóûÔ∏è</div>
        <div class="paper-emoji" id="p7">üóûÔ∏è</div>
        <div class="paper-emoji" id="p8">üóûÔ∏è</div>
        <div class="paper-emoji" id="p9">üóûÔ∏è</div>
    </div>
    <div class="boost-control">
        <div id="boost-timer-display" style="display:none">Boost: 15.0s</div>
        <button id="boost-btn" class="btn-boost" onclick="activateBoost(event)" disabled>[ Stack papers ]</button>
    </div>
</div>

<div id="tab-container">
    <h2 id="tab-title"></h2>
    <div id="tab-content"></div>
</div>

<div id="chat-container">
    <div class="chat-toggle" onclick="toggleChat()"><span>NETWORK CHAT (24H LOG)</span><span id="chat-toggle-icon">‚ñº</span></div>
    <div id="chat-log"></div>
    <div class="chat-input-area">
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="Broadcast message or !command..." maxlength="100">
            <button id="chat-send" onclick="handleInput()">EXEC</button>
        </div>
    </div>
</div>

<script>
    const _URL = 'https://wbdsmleccsxglvsgsqnw.supabase.co';
    const _KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndiZHNtbGVjY3N4Z2x2c2dzcW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MDMxNDIsImV4cCI6MjA4MzQ3OTE0Mn0.7IEkpvEDEvKAF2C3Lv6qU9omg6L7x-eVLyASxpyRXuk';
    const sb = supabase.createClient(_URL, _KEY);

    let playerUUID = localStorage.getItem('bruh_uid') || crypto.randomUUID();
    localStorage.setItem('bruh_uid', playerUUID);

    let game = {
        playerName: "Anonymous", new: 0, totalNew: 0, bruh: 0, level: 1, exp: 0, nextExp: 100, totalExp: 0,
        clickPower: 1, autoNew: 0, clickCount: 0, totalClicks: 0, boostActive: false, boostCooldown: 0, boostTimeLeft: 0,
        premiumMult: 1, stakedNews: 0, unclaimedNews: 0,
        upgrades: [
            { id: 0, name: "Neon Paperboy", baseCost: 15, count: 0, power: 1 },
            { id: 1, name: "Laser Press", baseCost: 150, count: 0, power: 12 },
            { id: 2, name: "Cyber Bureau", baseCost: 1800, count: 0, power: 65 },
            { id: 3, name: "Neural Network", baseCost: 25000, count: 0, power: 320 }
        ]
    };

    let chat = { messages: [], unreadCount: 0, isOpen: true, currentTab: null };

    function format(num) {
        if (num < 1000) return num.toFixed(1);
        const suffixes = ["k", "m", "b", "t"];
        let exp = Math.floor(Math.log10(num) / 3);
        if (exp <= 4) return (num / Math.pow(10, exp * 3)).toFixed(2) + suffixes[exp - 1];
        let alphaExp = exp - 5;
        let suffix = String.fromCharCode(97 + (alphaExp % 26)).repeat(Math.floor(alphaExp / 26) + 1);
        return (num / Math.pow(10, exp * 3)).toFixed(2) + suffix;
    }

    const globalChannel = sb.channel('global_hub', { config: { presence: { key: playerUUID } } });
    globalChannel
        .on('broadcast', { event: 'chat' }, (p) => {
            const isSelf = p.payload.uid === playerUUID;
            addChatMessage(p.payload.user, p.payload.msg, false, isSelf, p.payload.time);
            updateGlobalMsgCount();
        })
        .on('presence', { event: 'sync' }, () => {
            document.getElementById('online-count').innerText = Object.keys(globalChannel.presenceState()).length;
        })
        .subscribe(async (s) => {
            if (s === 'SUBSCRIBED') { 
                await globalChannel.track({ online_at: new Date().toISOString() }); 
                load24HChat();
                updateGlobalMsgCount();
            }
        });

    async function load24HChat() {
        const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
        const { data } = await sb.from('chat_history').select('*').gt('created_at', yesterday).order('created_at', { ascending: true });
        if (data) {
            chat.messages = data.map(d => ({
                s: d.sender, m: d.message, sys: false, time: new Date(d.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            }));
            renderChat();
        }
    }

    async function updateGlobalMsgCount() {
        const { count } = await sb.from('chat_history').select('*', { count: 'exact', head: true });
        document.getElementById('msg-total-val').innerText = format(count || 0);
    }

    async function handleInput() {
        const input = document.getElementById('chat-input');
        let val = input.value.trim(); if(!val) return;
        if (val.startsWith('!')) {
            // ... (Upgrade logic remains same)
        } else {
            const timeStr = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            globalChannel.send({ type: 'broadcast', event: 'chat', payload: { user: game.playerName, msg: val, uid: playerUUID, time: timeStr } });
            await sb.from('chat_history').insert({ sender: game.playerName, message: val });
            addChatMessage(game.playerName, val, false, true, timeStr);
        }
        input.value = '';
    }

    function addChatMessage(s, m, sys, self, time) {
        chat.messages.push({ s, m, sys, time: time || "00:00" });
        renderChat();
        if (!chat.isOpen && !self) { chat.unreadCount++; updateUI(); }
    }

    function renderChat() {
        const log = document.getElementById('chat-log');
        log.innerHTML = chat.messages.map(msg => `
            <div class="chat-message" style="${msg.sys ? 'opacity:0.6' : ''}">
                <span class="chat-time">${msg.time}</span>
                <b>${msg.s}:</b> ${msg.m}
            </div>`).join('');
        log.scrollTop = log.scrollHeight;
    }

    // Boilerplate for UI updates and Loops
    function updateUI() {
        document.getElementById('res-new').innerText = format(game.new);
        document.getElementById('res-bruh').innerText = format(game.bruh);
        document.getElementById('res-mult').innerText = format((1 + game.bruh) * (1 + (game.level * 0.05)) * (game.boostActive ? 5 : 1));
        document.getElementById('stat-level').innerText = format(game.level);
        document.getElementById('stat-exp').innerText = format(game.exp);
        document.getElementById('stat-total-exp').innerText = format(game.totalExp);
        const badge = document.getElementById('unread-count');
        if (chat.unreadCount > 0) { badge.innerText = chat.unreadCount; badge.classList.remove('hidden'); }
        else badge.classList.add('hidden');
    }

    setInterval(() => {
        document.getElementById('live-time').innerText = new Date().toUTCString();
        updateUI();
    }, 1000);

    // Initial load
    window.onload = () => { updateGlobalMsgCount(); load24HChat(); };
</script>
</body>
</html>
